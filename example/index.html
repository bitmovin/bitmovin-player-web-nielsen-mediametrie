<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Bitmovin + Nielsen Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bitmovin Player SDK -->
    <script src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"></script>

    <!-- Bitmovin Ad Module -->
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-advertising-bitmovin.js"
    ></script>

    <!-- Your Nielsen integration bundle from the dist/ folder -->
    <script src="../dist/bitmovin-player-measurements-nielsen.js"></script>

    <style>
      html,
      body {
        margin: 0;
        height: 100%;
      }
      #player {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="player"></div>

    <script>
      // Bitmovin player configuration
      const playerConfig = {
        key: 'KEY',
        playback: {
          muted: true,
          autoplay: true,
        },
        advertising: {
          adBreaks: [
            {
              tag: {
                type: 'vast',
                // More Ad Samples can be found here:
                // https://developers.google.com/interactive-media-ads/docs/sdks/html5/client-side/tags
                url: 'https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dredirecterror&nofb=1&correlator=',
              },
            },
          ],
        },
      };

      // Sample video source
      const sourceConfig = {
        title: 'Sintel',
        dash: 'https://bitmovin-a.akamaihd.net/content/sintel/sintel.mpd',
        poster: 'https://bitmovin.com/wp-content/uploads/2016/06/sintel-poster.jpg',
      };

      bitmovin.player.Player.addModule(window.bitmovin.player['advertising-bitmovin'].default);

      // Create the Bitmovin Player instance
      const playerContainer = document.getElementById('player');
      const player = new bitmovin.player.Player(playerContainer, playerConfig);

      player.load(sourceConfig);

      // Create the instance and attach it to player, with appropriate metadata for content
      const NielsenMeasurements = bitmovin.player.measurements.NielsenMeasurements;
      // Simplest example
      /*
      const measurements = new NielsenMeasurements({
        appId: 'PTEST',
        instanceName: 'testInstance'
      });
      */

      // Example of attaching Nielsen measurements with custom content metadata builder
      const measurements = new NielsenMeasurements({
        appId: 'PTEST',
        instanceName: 'testInstance',
        metadataBuilder: {
          buildContentMetadata: (player) =>
            // This example uses the default content metadata builder (withContent) but also adds a custom field
            new bitmovin.player.measurements.NielsenMetadataBuilder({
              subbrand: 'my-subbrand',
              assetId: 'Sintel',
            })
              .withContent(player)
              .withCustomField('nol_p0', 'customFieldValue'),
        },
      });

      measurements.attachTo(player);
    </script>
  </body>
</html>
